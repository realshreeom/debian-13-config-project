#!/usr/bin/env python3
import dbus
import dbus.mainloop.glib
from gi.repository import GLib
import datetime
import os

logfile = os.path.expanduser("~/.cache/nbs_notify.log")
os.makedirs(os.path.dirname(logfile), exist_ok=True)

def log(message):
    with open(logfile, "a") as f:
        f.write(message + "\n")

def notify(bus, message, *args):
    body = args[3]
    summary = args[2]
    timestamp = datetime.datetime.now().strftime("[%H:%M:%S]")
    log(f"{timestamp}  {summary}: {body}")

dbus.mainloop.glib.DBusGMainLoop(set_as_default=True)
session_bus = dbus.SessionBus()
session_bus.add_signal_receiver(
    notify,
    dbus_interface="org.freedesktop.Notifications",
    signal_name="Notify"
)

GLib.MainLoop().run()
